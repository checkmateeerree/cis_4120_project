<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Highlighter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
    }

    .App {
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      font-weight: 400;
    }

    .controls {
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
      align-items: center;
    }

    #file-input {
      display: none;
    }

    .file-label {
      padding: 8px 16px;
      background-color: #333;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .file-label:hover {
      background-color: #555;
    }

    .clear-button {
      padding: 8px 16px;
      background-color: #666;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .clear-button:hover:not(:disabled) {
      background-color: #888;
    }

    .clear-button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .color-selector {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .color-option {
      width: 32px;
      height: 32px;
      border: 2px solid;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      padding: 0;
    }

    .color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .color-option.active {
      transform: scale(1.15);
      box-shadow: 0 0 0 2px #333, 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    .pdf-container {
      display: flex;
      justify-content: center;
    }

    .pdf-wrapper {
      position: relative;
      display: inline-block;
      cursor: crosshair;
      user-select: none;
    }

    .highlight {
      position: absolute;
      border: 2px solid;
      pointer-events: none;
    }

    .highlight.current {
      border-style: dashed;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const COLOR_OPTIONS = [
      { name: 'Yellow', bg: 'rgba(255, 255, 0, 0.3)', border: 'rgba(255, 200, 0, 0.8)' },
      { name: 'Green', bg: 'rgba(0, 255, 0, 0.3)', border: 'rgba(0, 200, 0, 0.8)' },
      { name: 'Blue', bg: 'rgba(0, 150, 255, 0.3)', border: 'rgba(0, 100, 255, 0.8)' },
      { name: 'Red', bg: 'rgba(255, 0, 0, 0.3)', border: 'rgba(200, 0, 0, 0.8)' },
      { name: 'Pink', bg: 'rgba(255, 150, 200, 0.3)', border: 'rgba(255, 100, 150, 0.8)' },
      { name: 'Orange', bg: 'rgba(255, 165, 0, 0.3)', border: 'rgba(255, 140, 0, 0.8)' },
    ];

    function App() {
      const [file, setFile] = useState(null);
      const [fileUrl, setFileUrl] = useState(null);
      const [highlights, setHighlights] = useState([]);
      const [isDrawing, setIsDrawing] = useState(false);
      const [startPos, setStartPos] = useState(null);
      const [currentHighlight, setCurrentHighlight] = useState(null);
      const [selectedColor, setSelectedColor] = useState(COLOR_OPTIONS[0]);
      const containerRef = useRef(null);
      const [pdfDoc, setPdfDoc] = useState(null);
      const [pageNum, setPageNum] = useState(1);
      const [pdfPage, setPdfPage] = useState(null);
      const canvasRef = useRef(null);

      const onFileChange = (event) => {
        const uploadedFile = event.target.files[0];
        if (uploadedFile) {
          const url = URL.createObjectURL(uploadedFile);
          setFile(uploadedFile);
          setFileUrl(url);
          setHighlights([]);
          loadPDF(url);
        }
      };

      const loadPDF = async (url) => {
        try {
          const loadingTask = pdfjsLib.getDocument(url);
          const pdf = await loadingTask.promise;
          setPdfDoc(pdf);

          const page = await pdf.getPage(1);
          setPdfPage(page);

          renderPage(page);
        } catch (error) {
          console.error('Error loading PDF:', error);
        }
      };

      const renderPage = async (page) => {
        const canvas = canvasRef.current;
        if (!canvas) return;

        const viewport = page.getViewport({ scale: 1.5 });
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const context = canvas.getContext('2d');
        const renderContext = {
          canvasContext: context,
          viewport: viewport
        };

        await page.render(renderContext).promise;
      };

      useEffect(() => {
        return () => {
          if (fileUrl) {
            URL.revokeObjectURL(fileUrl);
          }
          setPdfDoc(null);
          setPdfPage(null);
        };
      }, [fileUrl]);

      const handleMouseDown = (e) => {
        if (!containerRef.current) return;

        const rect = containerRef.current.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        setIsDrawing(true);
        setStartPos({ x, y });
        setCurrentHighlight({ x, y, width: 0, height: 0 });
      };

      const handleMouseMove = (e) => {
        if (!isDrawing || !startPos || !containerRef.current) return;

        const rect = containerRef.current.getBoundingClientRect();
        const currentX = e.clientX - rect.left;
        const currentY = e.clientY - rect.top;

        const width = currentX - startPos.x;
        const height = currentY - startPos.y;

        setCurrentHighlight({
          x: width < 0 ? currentX : startPos.x,
          y: height < 0 ? currentY : startPos.y,
          width: Math.abs(width),
          height: Math.abs(height)
        });
      };

      const handleMouseUp = () => {
        if (currentHighlight && currentHighlight.width > 5 && currentHighlight.height > 5) {
          setHighlights([...highlights, {
            ...currentHighlight,
            id: Date.now(),
            color: selectedColor
          }]);
        }
        setIsDrawing(false);
        setStartPos(null);
        setCurrentHighlight(null);
      };

      return (
        <div className="App">
          <div className="controls">
            <input
              type="file"
              accept=".pdf"
              onChange={onFileChange}
              id="file-input"
            />
            <label htmlFor="file-input" className="file-label">
              Upload PDF
            </label>
            {file && (
              <>
                <div className="color-selector">
                  {COLOR_OPTIONS.map((color) => (
                    <button
                      key={color.name}
                      className={`color-option ${selectedColor.name === color.name ? 'active' : ''}`}
                      style={{ backgroundColor: color.bg, borderColor: color.border }}
                      onClick={() => setSelectedColor(color)}
                      title={color.name}
                    />
                  ))}
                </div>
                <button
                  onClick={() => setHighlights([])}
                  disabled={highlights.length === 0}
                  className="clear-button"
                >
                  Clear
                </button>
              </>
            )}
          </div>

          {file && (
            <div className="pdf-container">
              <div
                ref={containerRef}
                className="pdf-wrapper"
                onMouseDown={handleMouseDown}
                onMouseMove={handleMouseMove}
                onMouseUp={handleMouseUp}
                onMouseLeave={handleMouseUp}
              >
                <canvas ref={canvasRef}></canvas>

                {highlights.map((highlight) => (
                  <div
                    key={highlight.id}
                    className="highlight"
                    style={{
                      left: `${highlight.x}px`,
                      top: `${highlight.y}px`,
                      width: `${highlight.width}px`,
                      height: `${highlight.height}px`,
                      backgroundColor: highlight.color.bg,
                      borderColor: highlight.color.border,
                    }}
                  />
                ))}

                {currentHighlight && isDrawing && (
                  <div
                    className="highlight current"
                    style={{
                      left: `${currentHighlight.x}px`,
                      top: `${currentHighlight.y}px`,
                      width: `${currentHighlight.width}px`,
                      height: `${currentHighlight.height}px`,
                      backgroundColor: selectedColor.bg,
                      borderColor: selectedColor.border,
                    }}
                  />
                )}
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>